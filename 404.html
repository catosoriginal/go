<!DOCTYPE html>
<html lang="eng"> 
<body>
    <div id="loader-container">
    <p class="text maintext" id="mtext">Loading, please wait. If it takes over 5s, the server is sleeping. Please wait ~30s.</p>
    <img class="text statusgif" id="mstatusgif" src="assets/loading.gif">
    <p class="text statustext" id="mstatus">Loading</p>
</div>
    <style>
        #loader-container {
  display: flex;
  flex-direction: column; 
  align-items: center;   
  justify-content: center; 
  height: 100vh;    
  gap: 20px;           
  text-align: center;
}

.statustext {
    color:rgb(255, 127, 80);
    background-color: beige;
}

.text {
  font-size: 5vw;
  max-width: 90%;
  word-wrap: break-word;
  line-height: 1.2;
  white-space: normal;
}
    </style>
    <script>
        console.warn("\nWarning!\nI am not responsible for the websites you visit through my site.\nIf you see some bad sites, please report it to me: https://catosoriginal.github.io/go/report\n")
let redirectLinks = {}

fetch("publiclinks.json")
  .then(res => {
    if (!res.ok) throw new Error("Failed to load JSON");
    document.getElementById('mstatus').style.color = rgb(255, 80, 80);
    document.getElementById('mstatus').textContent = "Server Error";
    document.getElementById('mstatusgif').style.visibility = "hidden";
    return res.json();
  })
  .then(data => {
    redirectLinks = data;

    const segments = window.location.pathname.split('/').filter(Boolean);
    let redirectKey;
    let password = new URLSearchParams(window.location.search).get("p");
    if (!password) password = "none";

    if (segments.length > 1 && segments.length < 3) {
        redirectKey = segments[segments.length - 1];
    } else if (segments.length === 1) {
        redirectKey = segments[0];
    } else {
        redirectKey = "ERROR";
    }

    if (redirectLinks[redirectKey]) {
        document.getElementById('mtext').textContent = 'Redirecting to ' + redirectLinks[redirectKey];
        document.getElementById('mstatus').style.color = rgb(50, 205, 50);
        document.getElementById('mstatus').textContent = "Successfully!";
        document.getElementById('mstatusgif').style.visibility = "hidden";
        window.location.href = redirectLinks[redirectKey];
    } else {
        const serverlink = "https://go-server-idym.onrender.com/geturl";
        const data = { key: redirectKey, password: password };

        fetch(serverlink, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data)
        })
        .then(response => {
            if (!response.ok) return response.json().then(err => { throw err });
            return response.json();
        })
        .then(result => {
            console.log("Taked URL:", result.url);
            document.getElementById('mtext').textContent = 'Redirecting to ' + result.url;
            document.getElementById('mstatus').style.color = rgb(50, 205, 50);
            document.getElementById('mstatus').textContent = "Successfully!";
            document.getElementById('mstatusgif').style.visibility = "hidden";
            window.location.href = result.url;
        })
        .catch(err => {
            console.error("Request Error:", err.error);
            document.getElementById('mtext').textContent = err.error || "undefined error";
            document.getElementById('mstatus').style.color = rgb(255, 80, 80);
            document.getElementById('mstatus').textContent = "Server Error";
            document.getElementById('mstatusgif').style.visibility = "hidden";
        });
    }

  })
  .catch(err => {
    console.error("Error while loading JSON:", err);
    document.getElementById('mtext').textContent = "Failed to load links";
    document.getElementById('mstatus').style.color = rgb(255, 80, 80);
    document.getElementById('mstatus').textContent = "Server Error";
    document.getElementById('mstatusgif').style.visibility = "hidden";
  });
</script>
</body>
</html>
