<!DOCTYPE html>
<html lang="eng"> 
<body>
    <title>GO Redirect</title>
    <div id="loader-container">
    <p class="text maintext" id="mtext">Loading, please wait. If it takes over 5s, the server is sleeping. Please wait ~30s.</p>
    <img class="text statusgif" id="mstatusgif" src="assets/loading.gif">
    <p class="text statustext" id="mstatus">Loading</p>
</div>
    <style>
        #loader-container {
      display: inline-flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 1.5em;
      text-align: center;
      max-width: 90vw;
      min-width: 200px;
      padding: 2em;
      background-color: #fff5ee;
      border-radius: 2em;
      box-shadow: 0 0.5em 2em rgba(0,0,0,0.15);
      box-sizing: border-box;
      transition: all 0.3s ease;
    }

    .maintext {
      font-size: clamp(16px, 4vw, 28px);
      color: #333;
      line-height: 1.4;
      word-wrap: break-word;
      margin: 0;
    }

    .statusgif {
      width: clamp(50px, 10vw, 120px);
      height: auto;
      max-height: 25vh;
      object-fit: contain;
      transition: all 0.3s ease;
    }

    .statustext {
      font-size: clamp(14px, 3vw, 22px);
      font-weight: bold;
      color: rgb(255, 127, 80);
      background-color: #fff0d1;
      padding: 0.6em 1.5em;
      border-radius: 1.5em;
      box-shadow: 0 0.3em 1em rgba(0,0,0,0.1);
      margin: 0;
      transition: all 0.3s ease;
    }

    .hidden {
      display: none !important;
    }

    @media (max-width: 400px) {
      #loader-container {
        padding: 1.5em 1em;
        gap: 1em;
      }
      .statusgif {
        width: clamp(40px, 15vw, 80px);
      }
    }
    </style>
    <script>
        console.warn("\nWarning!\nI am not responsible for the websites you visit through my site.\nIf you see some bad sites, please report it to me: https://catosoriginal.github.io/go/report\n")
let redirectLinks = {}

fetch("https://catosoriginal.github.io/go/publiclinks.json")
  .then(res => {
    if (!res.ok) throw new Error("Failed to load JSON");
    document.getElementById('mstatus').style.color = "rgb(255, 80, 80)";
    document.getElementById('mstatus').textContent = "Server Error";
    document.getElementById('mstatusgif').style.display = "none";
    return res.json();
  })
  .then(data => {
    redirectLinks = data;

    const segments = window.location.pathname.split('/').filter(Boolean);
    let redirectKey;
    let password = new URLSearchParams(window.location.search).get("p");
    if (!password) password = "none";

    if (segments.length > 1 && segments.length < 3) {
        redirectKey = segments[segments.length - 1];
    } else if (segments.length === 1) {
        redirectKey = segments[0];
    } else {
        redirectKey = "ERROR";
    }

    if (redirectLinks[redirectKey]) {
        document.getElementById('mtext').textContent = 'Redirecting to ' + redirectLinks[redirectKey];
        document.getElementById('mstatus').style.color = "rgb(50, 205, 50)";
        document.getElementById('mstatus').textContent = "Successfully!";
        document.getElementById('mstatusgif').style.display = "none";
        window.location.href = redirectLinks[redirectKey];
    } else {
        const serverlink = "https://go-server-idym.onrender.com/geturl";
        const data = { key: redirectKey, password: password };

        fetch(serverlink, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data)
        })
        .then(response => {
            if (!response.ok) return response.json().then(err => { throw err });
            return response.json();
        })
        .then(result => {
            console.log("Taked URL:", result.url);
            document.getElementById('mtext').textContent = 'Redirecting to ' + result.url;
            document.getElementById('mstatus').style.color = "rgb(50, 205, 50)";
            document.getElementById('mstatus').textContent = "Successfully!";
            document.getElementById('mstatusgif').style.display = "none";
            window.location.href = result.url;
        })
        .catch(err => {
            console.error("Request Error:", err.error);
            document.getElementById('mtext').textContent = err.error || "undefined error";
            document.getElementById('mstatus').style.color = "rgb(255, 80, 80)";
            document.getElementById('mstatus').textContent = "Server Error";
            document.getElementById('mstatusgif').style.display = "none";
        });
    }

  })
  .catch(err => {
    console.error("Error while loading JSON:", err);
    document.getElementById('mtext').textContent = "Failed to load links";
    document.getElementById('mstatus').style.color = "rgb(255, 80, 80)";
    document.getElementById('mstatus').textContent = "Parsing Error";
    document.getElementById('mstatusgif').style.display = "none";
  });
</script>
</body>
</html>
